<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" type="image/png" href="https://animaproject.s3.amazonaws.com/home/favicon.png" />
    <link rel="stylesheet" type="text/css" href="css/personal-info.css" />
    <link rel="stylesheet" type="text/css" href="css/styleguide.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <!-- api gateway generated sdk -->
    <script src="./js/sdk/lib/axios/dist/axios.standalone.js"></script>
    <script src="./js/sdk/lib/CryptoJS/rollups/hmac-sha256.js"></script>
    <script src="./js/sdk/lib/CryptoJS/rollups/sha256.js"></script>
    <script src="./js/sdk/lib/CryptoJS/components/hmac.js"></script>
    <script src="./js/sdk/lib/CryptoJS/components/enc-base64.js"></script>
    <script src="./js/sdk/lib/url-template/url-template.js"></script>
    <script src="./js/sdk/lib/apiGatewayCore/sigV4Client.js"></script>
    <script src="./js/sdk/lib/apiGatewayCore/apiGatewayClient.js"></script>
    <script src="./js/sdk/lib/apiGatewayCore/simpleHttpClient.js"></script>
    <script src="./js/sdk/lib/apiGatewayCore/utils.js"></script>

    <script src="./js/sdk/apigClient.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1234.0.js"></script>
      <script>
        var sdk = apigClientFactory.newClient({});
      </script>
    <style>

    .icon {
  /* Adjust margin if necessary */
      margin-right: 10px;
      align-self: center; /* Align the icon vertically */
    }

    /* Container for the personal information and dining preference */
  .personal-dining-info {
    display: flex;
    flex-direction: column; /* Stack children vertically */
    align-items: flex-start; /* Align children to the start of the cross axis */
  }

    /* Make sure icons and inputs align nicely */
    .field-group {
      display: flex;
      align-items: center;
      margin-bottom: 15px; /* Space between each field group */
    }

    .editable-field {
      flex-grow: 1;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
      font-size: 30px; /* Adjust as needed */
    }
      }
      .button-style {
          background-color: #4CAF50; /* Green */
          border: none;
          color: white;
          padding: 10px 20px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
          margin: 4px 2px;
          cursor: pointer;
          border-radius: 4px;
      }
      .discard-button {
          background-color: #f44336; /* Red */
      }
    </style>
  </head>
  <body style="margin: 0; background: #ffffff">
    <input type="hidden" id="anPageName" name="page" value="personal-info" />
    <div class="container-center-horizontal">
      <div class="personal-info screen">
        <!-- Existing content up to name -->
             <div class="flex-row flex poppins-semi-bold-black-40px">
          <div class="home-page poppins-semi-bold-black-40px">Home Page</div>
          
          <div class="overlap-group">
          <div class="rectangle button-style" id="saveButton"> <!-- Added id here -->
            <div class="edit">Save</div>
            <img class="xnix-line-pencil-edit" src="img/xnix-line-pencil-edit-1.svg" alt="Save" />
          </div>
        </div>
        <div class="overlap-group2">
          <div class="rectangle button-style discard-button" id="discardButton"> <!-- Added id here -->
            <div class="sign-out">Discard</div>
          </div>
        </div>


        <div class="flex-col flex">
          <img class="ellipse-2" src="img/ellipse-2.jpg" alt="Ellipse 2" />
          <img class="interface-heart_02" src="img/interface---heart-02-1.svg" alt="Interface / Heart_02" />
          <input type="text" id="nameField" class="editable-field name" >
          
        </div>
        <!-- Phone and Email -->

      <div class="flex-col-1 flex-col-3">
        <img class="personal-information" src="img/personal-information.jpg" alt="Personal Information" />
        <img class="dining-preference" src="img/dining-preference.jpg" alt="Dining Preference" />
        <div class="personal-dining-info">
      <div class="field-group">
        <i class="fa-solid fa-phone icon"></i>
        <input type="text" id="telField" class="editable-field" placeholder="Default Phone">
      </div>
      <div class="field-group">
        <i class="fa-solid fa-envelope icon"></i>
        <input type="text" id="emailField" class="editable-field" placeholder="aa1234@columbia.edu">
      </div>
      </div>
      <!-- ... other elements ... -->
    </div>

    <div class="flex-col-2 flex-col-3">
  <div class="personal-dining-info">
    <div class="field-group">
      <i class="fa-solid fa-heart icon"></i>
      <input type="text" id="cuisineField" class="editable-field" placeholder="Italian, Thai">
    </div>
    <div class="field-group">
      <i class="fa-solid fa-location-dot icon"></i>
      <input type="text" id="locationField" class="editable-field" placeholder="Manhattan, NY">
    </div>
  </div>
</div>

       <!--  <div class="flex-col-2 flex-col-3">
           
              <div class="field-group">
         <img class="interface-heart_02-1" src="img/interface---heart-02.svg" alt="Interface / Heart_02" />
        
            <input type="text" id="cuisineField" class="editable-field" placeholder="Italian, Thai">
      </div>
      <div class="field-group">
        <img class="icon-pin-outline" src="img/---icon--pin-outline-.jpg" alt="icon 'pin outline'" />
         <input type="text" id="locationField" class="editable-field" placeholder="Manhattan, NY">
      </div> -->
              

        <!-- Rest of the existing content -->
        <div class="flex-row-1">
          <img class="image-11" src="img/image-11.png" alt="image 11" />
          <div class="x1-reviews poppins-normal-black-32px">
            <span class="poppins-normal-black-32px">(</span><span class="span1 poppins-normal-black-32px">1</span>
            <span class="poppins-normal-black-32px">) reviews</span>
          </div>
        </div>
      </div>
    </div>
    <!-- JavaScript for Save and Discard functionality -->
    <script>
      console.log(sdk);
      var username = 'eric';
      var userID = '29f78211-2096-41a3-92a7-ee2f35f12747';
      var buddyID = '948f44b9-f080-48b6-a152-7dbedc8a3ee7';
      var restaurantID = 'XjeGryxde-tQZF_Ewu7NCw';
      var searched_restaurants = [];

      var originalValues = {};
      var fields = ["nameField", "telField", "emailField", "cuisineField", "locationField"];

      // Function to store original values
      function storeOriginalValues() {
          fields.forEach(function(field) {
              originalValues[field] = document.getElementById(field).value;
          });
      }


// Helper function to display alert
function showAlert(message) {
  alert(message);
  // Prevent form submission if you have a form element
  // event.preventDefault();
}

function validatePhoneNumber(number) {
    var phonePattern = /^\(\d{3}\)\d{3}-\d{4}$/;
    if (phonePattern.test(number)) {
        return { isValid: true, message: "" };
    } else {
        return { isValid: false, message: "Phone number is not in the valid format (xxx)xxx-xxxx." };
    }
}

function validateEmail(email) {
    var emailPattern = /^[^@]+@\w+(\.\w+)+\w$/;
    if (emailPattern.test(email)) {
        return { isValid: true, message: "" };
    } else {
        return { isValid: false, message: "Email address is not in a valid format." };
    }
}

function validateCuisine(cuisine) {
    var allowedCuisines = ['chinese', 'italian', 'japanese', 'mexican', 'french', 'korean', 'american','thai'];
    if (allowedCuisines.includes(cuisine.toLowerCase())) {
        return { isValid: true, message: "" };
    } else {
        return { isValid: false, message: "Cuisine is not recognized. Allowed cuisines are: " + allowedCuisines.join(', ') + "." };
    }
}

function validateLocation(location) {
    var allowedLocations = ['manhattan, ny', 'long island city, ny', 'brooklyn, ny'];
    if (allowedLocations.includes(location.toLowerCase())) {
        return { isValid: true, message: "" };
    } else {
        return { isValid: false, message: "Location is not recognized. Allowed locations are: " + allowedLocations.join(', ') + "." };
    }
}

function validateFieldName(name) {
    // Example validation: ensure the name is not empty and is less than 50 characters
    if (name.trim() === "" || name.length > 50) {
        return { isValid: false, message: "Name must be filled and less than 50 characters." };
    } else {
        return { isValid: true, message: "" };
    }
}

// Function to handle the Save button click event
// ... rest of your existing HTML and JavaScript ...

// Function to handle the Save button click event
function saveInfo() {
    var body = { userID: userID };

    var nameField = document.getElementById('nameField');
    if (nameField.value !== originalValues['nameField']) {
        body.username = nameField.value;
    }
    var phoneField = document.getElementById('telField');
    if (phoneField.value !== originalValues['telField']) {
        body.phone = phoneField.value;
    }
    var emailField = document.getElementById('emailField');
    if (emailField.value !== originalValues['emailField']) {
        body.email = emailField.value;
    }
    var cuisineField = document.getElementById('cuisineField');
    if (cuisineField.value !== originalValues['cuisineField']) {
        body.cuisine = cuisineField.value;
    }
    var locationField = document.getElementById('locationField');
    if (locationField.value !== originalValues['locationField']) {
        body.location = locationField.value;
    }

    // Perform validation
    var validation = validateFields();
    if (!validation.isValid) {
        console.log('Validation failed:', validation.messages.join(', '));
        showAlert('Validation failed: ' + validation.messages.join('\n'));
        return;
    }

    if (Object.keys(body).length <= 1) {
        console.log('No changes made to the form.');
        return;
    }

    // Sending the data to the API
    sdk.editUserPut({}, body, {}).then((response) => {
        console.log('Edit profile response:', response);
        alert("Information saved!");
    }).catch((error) => {
        console.error('Error:', error);
        showAlert('There was an error saving the information.');
    });
}



// Add the fetchUserInfo function call inside the DOMContentLoaded listener
document.addEventListener("DOMContentLoaded", function() {
    storeOriginalValues();
    document.getElementById("saveButton").addEventListener("click", saveInfo);
    document.getElementById("discardButton").addEventListener("click", discardChanges);
    fetchUserInfo(); // This will fetch user data and update placeholders
});



function validateFields() {
    var validationResults = {
        isValid: true,
        messages: []
    }

    // Validate Phone Number if it has changed
    var phoneField = document.getElementById('telField');
    if (phoneField.value !== originalValues['telField']) {
        var phoneValidation = validatePhoneNumber(phoneField.value);
        if (!phoneValidation.isValid) {
            validationResults.isValid = false;
            validationResults.messages.push(phoneValidation.message);
        }
    }

    // Validate Email if it has changed
    var emailField = document.getElementById('emailField');
    if (emailField.value !== originalValues['emailField']) {
        var emailValidation = validateEmail(emailField.value);
        if (!emailValidation.isValid) {
            validationResults.isValid = false;
            validationResults.messages.push(emailValidation.message);
        }
    }

    // Add validation checks for other fields like 'cuisine' and 'location'
    var cuisineField = document.getElementById('cuisineField');
    if (cuisineField.value !== originalValues['cuisineField']) {
        var cuisineValidation = validateCuisine(cuisineField.value);
        if (!cuisineValidation.isValid) {
            validationResults.isValid = false;
            validationResults.messages.push(cuisineValidation.message);
        }
    }

    var locationField = document.getElementById('locationField');
    if (locationField.value !== originalValues['locationField']) {
        var locationValidation = validateLocation(locationField.value);
        if (!locationValidation.isValid) {
            validationResults.isValid = false;
            validationResults.messages.push(locationValidation.message);
        }
    }

    return validationResults;
}



// Your existing validation functions...
// validatePhoneNumber, validateEmail, validateCuisine, validateLocation...

// Helper function to display alerts
function showAlert(message) {
    alert(message);
}



function fetchUserInfo() {
    // Assuming 'userID' is a global variable containing the user's ID
    var params = {
        q: userID // The API is expecting a query parameter 'q'
    };
    var body = {};
    var additionalParams = {};

    // Call the getUserByIdGet function from the SDK
    sdk.getUserByIdGet(params, body, additionalParams)
        .then(function(response) {
            // Log the response for debugging
            console.log('User response:', response);

            // Assuming the relevant user data is in response.data
            fillUserData(response.data);
        })
        .catch(function(error) {
            // Log any error
            console.error('Error fetching user data:', error);
        });
}

function fillUserData(userData) {
    // Check if the userData object has the properties you expect
    // Update the placeholder attributes of the input fields
    if(userData) {
        document.getElementById('nameField').placeholder = userData.name || 'Enter Name';
        document.getElementById('telField').placeholder = userData.phone || 'Enter Phone Number';
        document.getElementById('emailField').placeholder = userData.email || 'Enter Email';
        document.getElementById('cuisineField').placeholder = userData.cuisine || 'Enter Favorite Cuisine';
        document.getElementById('locationField').placeholder = userData.location || 'Enter Location';
    }
}


      // Function to handle the Discard button
      function discardChanges() {
          fields.forEach(function(field) {
              document.getElementById(field).value = originalValues[field];
          });
      }

    // Object to track changes for each field
var fieldChanges = {
    nameField: false,
    telField: false,
    emailField: false,
    cuisineField: false,
    locationField: false
};

// Function to register a change for a field
function registerChange(fieldId) {
    fieldChanges[fieldId] = true;
}

// Set up event listeners to track changes on each field


      // Event listeners
      document.addEventListener("DOMContentLoaded", function() {
        storeOriginalValues();
        document.getElementById('nameField').addEventListener('input', function() { registerChange('nameField'); });
        document.getElementById('telField').addEventListener('input', function() { registerChange('telField'); });
        document.getElementById('emailField').addEventListener('input', function() { registerChange('emailField'); });
        document.getElementById('cuisineField').addEventListener('input', function() { registerChange('cuisineField'); });
        document.getElementById('locationField').addEventListener('input', function() { registerChange('locationField'); });
        document.getElementById("saveButton").addEventListener("click", saveInfo);
        document.getElementById("discardButton").addEventListener("click", discardChanges);
        fetchUserInfo();
          // // fetchUserData();
          // const exampleUserData = {
          //       name: "John Doe",
          //       phone: "+1 (555) 123-4567",
          //       email: "john.doe@example.com",
          //       favoriteCuisine: "Italian",
          //       location: "New York, NY"
          //   };

          //   // Call `fillUserData` with the example user data
          //   fillUserData(exampleUserData);
      });
    </script>
  </body>
</html>
